# 🏷 브랜드 & 상품 (Brands / Products)

## 1. 브랜드 정보 조회

### 기능적 요구사항

[Happy Path]

- 로그인 여부에 상관 없이 브랜드에 대한 정보를 조회할 수 있다.
- 브랜드 ID, 브랜드명에 대해 조회할 수 있다.

[Fail Case]

- 해당 ID에 해당하는 브랜드가 존재하지 않는다.

[기능 흐름]

1. 해당 ID 에 해당하는 브랜드 정보를 조회한다.

### 비기능적 요구사항

- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환한다.

| 케이스        | 설명                      | HTTP 상태코드 |
| ------------- | ------------------------- | ------------- |
| 브랜드 미존재 | 브랜드가 존재하지 않는다. | 404 Not Found |

## 2. 상품 목록 조회

### 기능적 요구사항

[Happy Path]

- 사용자는 로그인 여부에 상관 없이 상품 목록을 확인할 수 있다.
- 상품 목록을 조회할 때 상품명, (로그인한 경우) 좋아요 여부, 브랜드 명, 가격 정보, 총 좋아요 수를 확인할 수 있다.
- 사용자가 로그인하지 않은 경우, 좋아요 여부는 항상 false이다.
- 특정 브랜드의 상품만 필터링 가능하다. `brandId`
- 최신순 `latest` , 가격 낮은 순 `price_asc` , 인기순 `like_desc` 에 대해 정렬이 가능하다.
- 하나의 페이지 당 최소 20 ~ 최대 100개의 상품을 조회 가능하다. `size` `page`
- 품절 상태인 상품은 리스트에 나타나지 않아야 한다.

[Fail Case]

- 브랜드 상품 필터링 시, 브랜드가 존재하지 않는다.

[기능 흐름]

1. 상품 목록을 조회한다.

### 비기능적 요구사항

- 3초 이내에 완료되어야 한다. (완료되지 않으면 오류로 간주된다.)

| 케이스        | 설명                                             | HTTP 상태코드 |
| ------------- | ------------------------------------------------ | ------------- |
| 브랜드 미존재 | 브랜드 필터링 시, 해당 브랜드가 존재하지 않는다. | 404 Not Found |

---

## 3. 상품 정보 조회

### 기능적 요구사항

[Happy Path]

- 사용자는 로그인 여부에 상관 없이 상품 상세를 확인할 수 있다.
- 상품 정보를 조회할 때, 상품명, (로그인한 경우) 좋아요 여부, 브랜드 명, 가격 정보, 상품 상세 정보, 총 좋아요 수를 확인할 수 있다.
- 품절 상태인 상품은 품절 임을 나타내야 한다.
- 사용자가 로그인하지 않은 경우, 좋아요 여부는 항상 false 이다.

[Fail Case]

- 상품이 존재하지 않으면 오류를 반환한다.

[기능 흐름]

1. 상품 ID 에 해당하는 상품 정보를 조회한다.
2. 로그인 시,
   1. 좋아요 여부를 확인한다.

### 비기능적 요구사항

- 1초 이내에 완료되어야 한다. (완료되지 않으면 오류로 간주한다.)
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환한다.

| 케이스      | 설명                                   | HTTP 상태코드 |
| ----------- | -------------------------------------- | ------------- |
| 상품 미존재 | ID 에 해당하는 상품이 존재하지 않는다. | 404 Not Found |

---

# ❤️ 좋아요 (Likes)

## 4. 상품 좋아요 등록

### 기능적 요구사항

[Happy Path]

- 로그인한 사용자는 자신이 좋아요하지 않은 상품에 대해 좋아요 등록을 할 수 있다.

[Fail Case]

- 로그인하지 않을 시, 오류를 반환한다.
- 이미 좋아요한 상품의 경우 오류를 반환한다.
- 상품이 존재하지 않는 경우 오류를 반환한다.

[기능 흐름]

1. 사용자가 로그인을 했는지 확인한다.
2. 좋아요하려는 상품이 존재하는지 확인한다.
3. 이미 좋아요했는지 확인한다.
4. 상품에 대해 좋아요 등록을 한다.

### 비기능적 요구사항

- 사용자 인증은 `X-USER-ID` 헤더를 기반으로 처리된다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환한다.

| 케이스        | 설명                    | HTTP 상태코드    |
| ------------- | ----------------------- | ---------------- | ---------------- |
| 미로그인      | 로그인 하지 않은 사용자 | 사용자 정보 없음 | 401 UnAuthorized |
| 좋아요 기등록 | 이미 좋아요한 상품      | 409 Conflict     |
| 상품 미존재   | 상품이 존재하지 않음    | 404 NotFound     |

---

## 5. 상품 좋아요 취소

### 기능적 요구사항

[Happy Path]

- 로그인한 사용자는 자신이 좋아용한 상품에 대해 좋아요 취소를 할 수 있다.

[Fail Case]

- 로그인하지 않을 시, 오류를 반환한다.
- 좋아요하지 않은 상품의 경우 오류를 반환한다.
- 상품이 존재하지 않는 경우 오류를 반환한다.

[기능 흐름]

1. 사용자가 로그인을 했는지 확인한다.
2. 좋아요 취소하려는 상품이 존재하는지 확인한다.
3. 이미 좋아요했는지 확인한다.
4. 상품에 대해 좋아요 취소를 한다.

### 비기능적 요구사항

- 사용자 인증은 `X-USER-ID` 헤더를 기반으로 처리된다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환한다.

| 케이스           | 설명                      | HTTP 상태코드    |
| ---------------- | ------------------------- | ---------------- |
| 미로그인         | 로그인 하지 않은 사용자   | 401 UnAuthorized |
| 좋아요 하지 않음 | 이미 좋아요하지 않은 상품 | 409 Conflict     |
| 상품 미존재      | 상품이 존재하지 않음      | 404 NotFound     |

---

## 6. 내가 좋아요 한 상품 목록 조회

### 기능적 요구사항

[Happy Path]

- 로그인한 사용자는, 자신이 좋아요한 상품 리스트를 조회할 수 있다.
- 상품 리스트는 최근에 좋아요한 순으로 정렬된다.
- 상품명, 브랜드 명, 가격 정보에 대해 조회 가능하다.

[Fail Case]

- 로그인하지 않은 사용자의 경우 오류를 반환한다.

[기능 흐름]

1. 사용자가 좋아요한 상품 리스트를 반환한다.

### 비기능적 요구사항

- 사용자 인증은 `X-USER-ID` 헤더를 기반으로 처리된다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환한다.

| 케이스   | 설명                   | HTTP 상태코드 |
| -------- | ---------------------- | ------------- |
| 미로그인 | 로그인하지 않은 사용자 | 404 NotFound  |

---

# 🛒 장바구니 (Carts)

## 7. 장바구니에 담기

### 기능적 요구사항

[Happy Path]

- 로그인한 사용자는 상품을 장바구니에 넣을 수 있다.
- 수량을 지정하여 장바구니에 넣으면, 해당 수량으로 장바구니에 상품이 등록된다.

[Fail Case]

- 로그인하지 않은 사용자의 경우 오류를 반환한다.
- 존재하지 않는 상품의 경우 오류를 반환한다.
- 수량보다 재고가 더 적을 경우 오류를 반환한다.
- 상품이 품절 상태인 경우 오류를 반환한다.

[기능 흐름]

1. 로그인한 사용자를 조회한다.
2. 상품을 조회한다.
3. 상품이 품절 상태인지 확인한다.
4. 해당 상품이 장바구니에 있는지 확인한다.
   1. 상품이 장바구니에 있으면 수량을 새로운 수량으로 변경한다.
   2. 상품이 장바구니에 없으면 장바구니에 상품을 추가한다.

### 비기능적 요구사항

- 사용자 인증은 `X-USER-ID` 헤더를 기반으로 처리된다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환한다.

| 케이스                | 설명                               | HTTP 상태코드    |
| --------------------- | ---------------------------------- | ---------------- |
| 미로그인              | 로그인하지 않은 사용자             | 401 UnAuthorized |
| 상품 미존재           | 상품이 존재하지 않음               | 404 Not Found    |
| 품절                  | 상품이 품절 상태임                 | 409 Conflict     |
| 재고보다 더 많은 수량 | 등록하려는 수량이 재고보다 더 많음 | 409 Conflict     |

---

## 8. 장바구니에서 삭제

### 기능적 요구사항

[Happy Path]

- 로그인한 사용자가 자신의 장바구니에 있는 상품을 삭제한다.

[Fail Case]

- 로그인하지 않은 사용자의 경우 오류를 반환한다.
- 존재하지 않는 상품의 경우 오류를 반환한다.
- 장바구니에 없는 상품인 경우 오류를 반환한다.

[기능 흐름]

1. 로그인한 사용자를 조회한다.
2. 장바구니 상품을 조회한다.
3. 장바구니에서 상품을 삭제한다.

### 비기능적 요구사항

- 사용자 인증은 `X-USER-ID` 헤더를 기반으로 처리된다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환한다.

| 케이스                 | 설명                                       | HTTP 상태코드    |
| ---------------------- | ------------------------------------------ | ---------------- |
| 미로그인               | 로그인하지 않은 사용자                     | 401 UnAuthorized |
| 상품 미존재            | 상품이 존재하지 않음                       | 404 Not Found    |
| 장바구니에 상품 미존재 | 삭제하려는 상품이 장바구니에 존재하지 않음 | 400 BadRequest   |

---

## 9. 장바구니 리스트 확인

### 기능적 요구사항

[Happy Path]

- 로그인한 사용자가 장바구니에 등록한 상품 목록을 조회한다.
- 상품 목록은 최소 20개 ~ 최대 100개까지 조회 가능하다.
- 상품 목록을 조회할 때 상품명, 좋아요 여부, 브랜드 명, 가격 정보, 총 좋아요 수, 등록한 수량, 품절 여부, 재고<수량 여부를 확인할 수 있다.
- 상품이 품절 상태로 변경되면 품절 상태임을 사용자에게 표기한다.
- 상품의 재고보다 수량이 더 많으면 사용자에게 표기한다.

[Fail Case]

- 로그인하지 않은 사용자의 경우 오류를 반환한다.

[기능 흐름]

1. 사용자를 조회한다.
2. 사용자가 장바구니에 넣은 상품을 조회한다.

### 비기능적 요구사항

- 사용자 인증은 `X-USER-ID` 헤더를 기반으로 처리된다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환한다.

| 케이스   | 설명                          | HTTP 상태코드    |
| -------- | ----------------------------- | ---------------- |
| 미로그인 | 사용자가 로그인하지 않은 상태 | 401 UnAuthorized |

---

# 🧾 주문 / 결제 (Orders)

## 10. 주문 요청

### 기능적 요구사항

[Happy Path]

- 로그인한 사용자가 장바구니에 있는 상품들을 주문 요청한다.
- 주문하는 경우 모든 상품의 주문 수량이 상품의 재고보다 적어야 한다.
- 상품 주문이 완료되면 상품의 재고를 주문 수량만큼 줄여야 한다.
- 상품 주문 시 결제는 포인트와 카드 결제가 있다.
- 카드 결제가 실패하더라도 주문은 생성되어야 한다.
- 상품 주문이 완료되면 주문 정보를 외부 시스템(ex. 카카오톡) 으로 보낸다.
- 사용자는 전체 가격에 대해 쿠폰을 사용 가능하다.

[Fail Case]

- 로그인하지 않은 사용자의 경우 오류를 반환한다.
- 주문하려는 상품이 존재하지 않는 경우 오류를 반환한다.
- 상품의 재고 수량보다 주문 수량이 더 많은 경우 오류를 반환한다.
- 상품의 총 금액보다 보유 포인트가 더 적으면 오류를 반환한다.

[기능 흐름]

1. 로그인한 사용자를 조회한다.
2. 주문하려는 상품 리스트를 확인한다.
   1. 상품 정보를 조회한다.
   2. 상품의 재고보다 주문 수량이 더 적은지 확인한다.
   3. 상품의 재고 -= 주문 수량
3. 주문하려는 쿠폰을 조회한다.
   1. 쿠폰을 조회한다.
   2. 사용하려는 쿠폰이 사용 가능한지 확인한다. (수량, 기한, 소유자)
   3. 쿠폰 사용 처리를 한다.
4. 상품 가격이 일치하는지 확인한다.
5. 결제 방식을 확인한다.
   1. 카드인 경우
      1. pg 사에 카드결제 요청을 보낸다.
      2. 상품 주문 상태를 pending으로 처리한다.
      3. 결제가 완료되면 결제 완료로 변경한다.
   2. 포인트인 경우
      1. 주문하려는 상품 가격보다 보유 포인트가 더 많은지 확인한다.
      2. 보유 포인트 -= 주문 가격
6. 주문을 완료한다.
7. 주문 정보를 외부 시스템(ex. 카카오톡) 으로 전송한다.

### 비기능적 요구사항

- 사용자 인증은 `X-USER-ID` 헤더를 기반으로 처리된다.
- 동시에 주문이 오는 경우에도 재고가 여러개의 주문의 수량보다 적으면 안된다. (동시성 처리)
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환한다.

| 케이스                  | 설명                                                | HTTP 상태코드    |
| ----------------------- | --------------------------------------------------- | ---------------- |
| 미로그인                | 사용자가 로그인하지 않음                            | 401 UnAuthorized |
| 상품 미존재             | 주문하려는 상품이 존재하지 않음                     | 404 Not Found    |
| 쿠폰 미존재             | 쿠폰이 존재하지 않음                                | 400 Bad Request  |
| 재고보다 더 많은 수량   | 현재 재고보다 더 많은 수량을 주문                   | 409 Conflict     |
| 상품 품절               | 주문하려는 상품이 품절 상태임                       | 409 Conflict     |
| 포인트 부족             | 주문하려는 금액보다 보유 포인트가 더 적음           | 400 BadRequest   |
| 금액이 일치하지 않음    | 주문 시 요구되는 금액과 로직상 금액이 일치하지 않음 | 400 BadRequest   |
| 사용자의 쿠폰이 아님    | 사용자의 쿠폰이 아님                                | 403 Forbidden    |
| 이미 기한이 지난 쿠폰임 | 이미 기한이 지난 쿠폰임                             | 409 Conflict     |
| 이미 사용한 쿠폰        | 이미 사용한 쿠폰임                                  | 409 Conflict     |
| 사용자의 카드가 아님    | 사용자의 카드가 아님                                | 403 Forbidden    |

---

## 11. 유저의 주문 목록 조회

### 기능적 요구사항

[Happy Path]

- 로그인한 사용자는 자신이 주문했던 내역을 조회할 수 잇다.
- 주문은 최신순으로 정렬 가능하다.
- 기간을 설정하여 특정 기간 내에 주문했던 내역을 조회 가능하다.
- 주문번호, 주문 금액, 주문 일자, 주문 상태를 확인 가능하다.
- 최소 20개 ~ 최대 100개의 목록을 조회 가능하다.
- 주문은 어떤 식으로 결제가 되었는지 확인 가능하다.

[Fail Case]

- 사용자 로그인 상태가 아니다.

[기능 흐름]

1. 로그인한 사용자를 조회한다.
2. 사용자의 주물 목록을 조회한다.

### 비기능적 요구사항

- 사용자 인증은 `X-USER-ID` 헤더를 기반으로 처리된다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환한다.

| 케이스   | 설명                       | HTTP 상태코드    |
| -------- | -------------------------- | ---------------- |
| 미로그인 | 사용자가 로그인상태가 아님 | 401 UnAuthorized |

---

## 12. 단일 주문 상세 조회

### 기능적 요구사항

[Happy Path]

- 로그인한 사용자는 자신이 주문했던 내역을 상세 조회 가능하다.
- 주문번호, 주문 금액, 주문 전체 상품, 주문 일자, 주문 상태 조회가 가능하다.
- 주문된 상품의 경우 상품명, 브랜드 명, 가격 정보, 수량 정보를 확인할 수 있다.
- 삭제되었거나 품절된 상품이라도 주문이 완료된 건이면 조회 가능하다.
- 해당 주문에 사용된 쿠폰 정보를 조회할 수 있다.
- 사용자가 주문을 결제한 방식을 조회할 수 있다.

[Fail Case]

- 사용자가 로그인한 상태가 아니다.
- 해당 주문이 로그인한 사용자의 주문이 아니다.

[기능 흐름]

1. 로그인한 사용자 정보를 조회한다.
2. 주문ID에 해당하는 주문을 조회한다.
3. 해당 주문이 로그인한 사용자의 것인지 확인한다.
4. 해당 주문에 포함된 상품 정보를 조회한다.
5. 해당 주문에 사용된 쿠폰 정보를 조회한다.
6. 해당 주문의 결제 방식을 조회한다.

### 비기능적 요구사항

- 사용자 인증은 `X-USER-ID` 헤더를 기반으로 처리된다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환한다.

| 케이스             | 설명                                      | HTTP 상태코드    |
| ------------------ | ----------------------------------------- | ---------------- |
| 미로그인           | 사용자가 로그인한 상태가 아님             | 401 UnAuthorized |
| 주문 ID 미존재     | 주문 ID에 해당하는 주문이 존재하지 않음   | 404 NotFound     |
| 주문 접근권한 없음 | 해당 주문이 로그인한 사용자의 주문이 아님 | 403 Forbidden    |

# 🏷️ 쿠폰 (Coupon)

쿠폰 도메인 요구사항

- 쿠폰은 정액/정률이 있다.
  - 정액 쿠폰은 A 금액 이상 주문 시 B 금액 만큼 할인해준다.
  - 정률 쿠폰은 A 금액 이상 주문 시 B % 할인해주며, 최대 C 금액 만큼 할인이 가능하다.
- 쿠폰은 사용 기한이 존재하며, 주문 시 사용 기한이 지나면 사용이 불가능하다.
- 하나의 쿠폰은 2번 이상 사용하지 못한다.

## 13. 사용자 쿠폰 조회

### 기능적 요구사항

[Happy Path]

- 로그인한 사용자는 자신이 소유한 전체 쿠폰 리스트를 조회 가능하다.
- 쿠폰은 사용 가능한 쿠폰만 조회 가능하다.
- 쿠폰은 전체 금액에 대하여 정액/정률로 사용 가능하다.

[Fail Case]

- 사용자가 로그인한 상태가 아니다.

[기능 흐름]

1. 로그인한 사용자 정보를 조회한다.
2. 로그인한 사용자의 쿠폰 리스트를 조회한다.

### 비기능적 요구사항

- 사용자 인증은 `X-USER-ID` 헤더를 기반으로 처리된다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환한다.

| 케이스   | 설명                          | HTTP 상태코드    |
| -------- | ----------------------------- | ---------------- |
| 미로그인 | 사용자가 로그인한 상태가 아님 | 401 UnAuthorized |
